<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaki Kimhi&#39;s Site</title>
    <meta name="description" content="Docs, Guides and specs">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Yaki Kimhi&#39;s Site">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Yaki Kimhi&#39;s Site">
	<script src="mermaid.js"></script>
<script src="mermaid.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script> </head>
  <body dir=ltr>
    <header>
      <h1 class="home"><a href="/">Yaki Kimhi&#39;s Site</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
	      <!--  <div></div> -->
    </header>

    <main class="tmpl-post">

      <!-- Delete this message -->
      <div class="warning"  style="text-align: center;">
       <h1> Yaki Kimhi&#39;s Site </h1>
      </div>
      <!-- Stop deleting -->

      <h1></h1>

<time datetime="2022-02-11">11 Feb 2022</time><a href="/tags/devops/" class="post-tag">devops</a><a href="/tags/chartmuseum/" class="post-tag">chartmuseum</a><a href="/tags/helm/" class="post-tag">helm</a><a href="/tags/k8s/" class="post-tag">k8s</a>

<p>[[2021-04-25]]</p>
<h1 id="chartmuseum" tabindex="-1">ChartMuseum <a class="direct-link" href="#chartmuseum" aria-hidden="true">#</a></h1>
<p>[[index | ◊ì◊£ ◊î◊ë◊ô◊™]]/[[◊ê◊ó◊®]]</p>
<h2 id="about-chartmuseum" tabindex="-1">About ChartMuseum <a class="direct-link" href="#about-chartmuseum" aria-hidden="true">#</a></h2>
<p><a href="https://github.com/helm/chartmuseum/actions?query=workflow%3Abuild"><img src="https://github.com/helm/chartmuseum/workflows/build/badge.svg" alt="GitHub Actions status"></a><br>
<a href="https://goreportcard.com/report/github.com/helm/chartmuseum"><img src="https://goreportcard.com/badge/github.com/helm/chartmuseum" alt="Go Report Card"></a><br>
<a href="https://godoc.org/github.com/helm/chartmuseum"><img src="https://godoc.org/github.com/helm/chartmuseum?status.svg" alt="GoDoc"></a></p>
<p align="center"><img align="center" src="logo2.png"></p><br/>
<p><em>ChartMuseum</em> is an open-source <strong><a href="https://helm.sh/docs/topics/chart_repository/">Helm Chart Repository</a></strong> server written in Go (Golang), with support for cloud storage backends, including <a href="https://cloud.google.com/storage/">Google Cloud Storage</a>, <a href="https://aws.amazon.com/s3/">Amazon S3</a>, <a href="https://azure.microsoft.com/en-us/services/storage/blobs/">Microsoft Azure Blob Storage</a>, <a href="https://www.alibabacloud.com/product/oss">Alibaba Cloud OSS Storage</a>, <a href="https://developer.openstack.org/api-ref/object-store/">Openstack Object Storage</a>, <a href="https://cloud.oracle.com/storage">Oracle Cloud Infrastructure Object Storage</a>, <a href="https://cloud.baidu.com/product/bos.html">Baidu Cloud BOS Storage</a>, <a href="https://intl.cloud.tencent.com/product/cos">Tencent Cloud Object Storage</a>, <a href="https://www.163yun.com/product/nos">Netease Cloud NOS Storage</a>, <a href="https://www.digitalocean.com/products/spaces/">DigitalOcean Spaces</a>, <a href="https://min.io/">Minio</a>, and <a href="https://etcd.io/">etcd</a>.</p>
<p>Works as a valid Helm Chart Repository, and also provides an API for uploading charts.</p>
<img width="120" align="right" src="https://github.com/golang-samples/gopher-vector/raw/master/gopher-side_color.png">
<img width="40" align="right" src="https://github.com/golang-samples/gopher-vector/raw/master/gopher-side_color.png">
<p>Powered by some great Go technology:</p>
<ul>
<li><a href="https://github.com/helm/helm">helm/helm</a> - for working with charts</li>
<li><a href="https://github.com/gin-gonic/gin">gin-gonic/gin</a> - for HTTP routing</li>
<li><a href="https://github.com/urfave/cli">urfave/cli</a> - for command line option parsing</li>
<li><a href="https://github.com/spf13/viper">spf13/viper</a> - for configuration</li>
<li><a href="https://github.com/uber-go/zap">uber-go/zap</a> - for logging</li>
<li><a href="https://github.com/chartmuseum/auth">chartmuseum/auth</a> - for auth</li>
<li><a href="https://github.com/chartmuseum/storage">chartmuseum/storage</a> - for multi-cloud storage</li>
</ul>
<h2 id="api" tabindex="-1">API <a class="direct-link" href="#api" aria-hidden="true">#</a></h2>
<h3 id="helm-chart-repository" tabindex="-1">Helm Chart Repository <a class="direct-link" href="#helm-chart-repository" aria-hidden="true">#</a></h3>
<ul>
<li><code>GET /index.yaml</code> - retrieved when you run <code>helm repo add chartmuseum http://localhost:8080/</code></li>
<li><code>GET /charts/mychart-0.1.0.tgz</code> - retrieved when you run <code>helm install chartmuseum/mychart</code></li>
<li><code>GET /charts/mychart-0.1.0.tgz.prov</code> - retrieved when you run <code>helm install</code> with the <code>--verify</code> flag</li>
</ul>
<h3 id="chart-manipulation" tabindex="-1">Chart Manipulation <a class="direct-link" href="#chart-manipulation" aria-hidden="true">#</a></h3>
<ul>
<li><code>POST /api/charts</code> - upload a new chart version</li>
<li><code>POST /api/prov</code> - upload a new provenance file</li>
<li><code>DELETE /api/charts/&lt;name&gt;/&lt;version&gt;</code> - delete a chart version (and corresponding provenance file)</li>
<li><code>GET /api/charts</code> - list all charts</li>
<li><code>GET /api/charts/&lt;name&gt;</code> - list all versions of a chart</li>
<li><code>GET /api/charts/&lt;name&gt;/&lt;version&gt;</code> - describe a chart version</li>
<li><code>HEAD /api/charts/&lt;name&gt;</code> - check if chart exists (any versions)</li>
<li><code>HEAD /api/charts/&lt;name&gt;/&lt;version&gt;</code> - check if chart version exists</li>
</ul>
<h3 id="server-info" tabindex="-1">Server Info <a class="direct-link" href="#server-info" aria-hidden="true">#</a></h3>
<ul>
<li><code>GET /</code> - HTML welcome page</li>
<li><code>GET /info</code> - returns current ChartMuseum version</li>
<li><code>GET /health</code> - returns 200 OK</li>
</ul>
<h2 id="uploading-a-chart-package" tabindex="-1">Uploading a Chart Package <a class="direct-link" href="#uploading-a-chart-package" aria-hidden="true">#</a></h2>
<p><sub><em>Follow <strong>&quot;How to Run&quot;</strong> section below to get ChartMuseum up and running at ht<span>tp:/</span>/localhost:8080</em><sub></p>
<p>First create <code>mychart-0.1.0.tgz</code> using the <a href="https://docs.helm.sh/using_helm/#installing-helm">Helm CLI</a>:</p>
<pre><code>cd mychart/
helm package .
</code></pre>
<p>Upload <code>mychart-0.1.0.tgz</code>:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> --data-binary <span class="token string">"@mychart-0.1.0.tgz"</span> http://localhost:8080/api/charts</code></pre>
<p>If you've signed your package and generated a <a href="https://github.com/helm/helm-www/blob/master/content/en/docs/topics/provenance.md">provenance file</a>, upload it with:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> --data-binary <span class="token string">"@mychart-0.1.0.tgz.prov"</span> http://localhost:8080/api/prov</code></pre>
<p>Both files can also be uploaded at once (or one at a time) on the <code>/api/charts</code> route using the <code>multipart/form-data</code> format:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> -F <span class="token string">"chart=@mychart-0.1.0.tgz"</span> -F <span class="token string">"prov=@mychart-0.1.0.tgz.prov"</span> http://localhost:8080/api/charts</code></pre>
<p>You can also use the <a href="https://github.com/chartmuseum/helm-push">helm-push plugin</a>:</p>
<pre><code>helm push mychart/ chartmuseum
</code></pre>
<h2 id="installing-charts-into-kubernetes" tabindex="-1">Installing Charts into Kubernetes <a class="direct-link" href="#installing-charts-into-kubernetes" aria-hidden="true">#</a></h2>
<p>Add the URL to your <em>ChartMuseum</em> installation to the local repository list:</p>
<pre class="language-bash"><code class="language-bash">helm repo <span class="token function">add</span> chartmuseum http://localhost:8080</code></pre>
<p>Search for charts:</p>
<pre class="language-bash"><code class="language-bash">helm search repo chartmuseum/</code></pre>
<p>Install chart:</p>
<pre class="language-bash"><code class="language-bash">helm <span class="token function">install</span> chartmuseum/mychart --generate-name</code></pre>
<h2 id="how-to-run" tabindex="-1">How to Run <a class="direct-link" href="#how-to-run" aria-hidden="true">#</a></h2>
<h3 id="cli" tabindex="-1">CLI <a class="direct-link" href="#cli" aria-hidden="true">#</a></h3>
<h4 id="installation" tabindex="-1">Installation <a class="direct-link" href="#installation" aria-hidden="true">#</a></h4>
<p>Install binary using <a href="https://gofi.sh/">GoFish</a>:</p>
<pre><code>gofish install chartmuseum
==&gt; Installing chartmuseum...
üê†  chartmuseum 0.13.1: installed in 95.431145ms
</code></pre>
<p>or you can use the installer script:</p>
<pre><code>curl https://raw.githubusercontent.com/helm/chartmuseum/main/scripts/get-chartmuseum | bash
</code></pre>
<p>or download manually from the <a href="https://github.com/helm/chartmuseum/releases">releases page</a>,<br>
which also contains all package checksums and signatures.</p>
<p>Determine your version with <code>chartmuseum --version</code>.</p>
<h4 id="configuration" tabindex="-1">Configuration <a class="direct-link" href="#configuration" aria-hidden="true">#</a></h4>
<p>Show all CLI options with <code>chartmuseum --help</code>. Common configurations can be seen below.</p>
<p>All command-line options can be specified as environment variables, which are defined by the command-line option, capitalized, with all <code>-</code>'s replaced with <code>_</code>'s.</p>
<p>For example, the env var <code>STORAGE_AMAZON_BUCKET</code> can be used in place of <code>--storage-amazon-bucket</code>.</p>
<h5 id="using-config-yaml-file-example" tabindex="-1">Using config yaml file example <a class="direct-link" href="#using-config-yaml-file-example" aria-hidden="true">#</a></h5>
<p>When using a yaml file instead of the command lineÔºå Convert the <code>-</code> of the parameter in the command to <code>.</code>.<br>
Note that <code>--storage</code> is converted to <code>storage.backend</code></p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">debug</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span><br><span class="token key atrule">storage.backend</span><span class="token punctuation">:</span> local<br><span class="token key atrule">storage.local.rootdir</span><span class="token punctuation">:</span> &lt;storage_path<span class="token punctuation">></span><br><span class="token key atrule">bearerauth</span><span class="token punctuation">:</span> <span class="token number">1</span><br><span class="token key atrule">authrealm</span><span class="token punctuation">:</span> &lt;authorization server url<span class="token punctuation">></span><br><span class="token key atrule">authservice</span><span class="token punctuation">:</span> &lt;authorization server service name<span class="token punctuation">></span><br><span class="token key atrule">authcertpath</span><span class="token punctuation">:</span> &lt;path to authorization server public pem file<span class="token punctuation">></span> <br><span class="token key atrule">depth</span><span class="token punctuation">:</span> <span class="token number">2</span><br></code></pre>
<h4 id="using-with-amazon-s3-or-compatible-services-like-minio-or-digitalocean." tabindex="-1">Using with Amazon S3 or Compatible services like Minio or DigitalOcean. <a class="direct-link" href="#using-with-amazon-s3-or-compatible-services-like-minio-or-digitalocean." aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-s3-bucket</code></p>
<p>For Amazon S3, <code>endpoint</code> is automatically inferred.</p>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"amazon"</span> <span class="token punctuation">\</span><br>  --storage-amazon-bucket<span class="token operator">=</span><span class="token string">"my-s3-bucket"</span> <span class="token punctuation">\</span><br>  --storage-amazon-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-amazon-region<span class="token operator">=</span><span class="token string">"us-east-1"</span></code></pre>
<p>For S3 compatible services like Minio, set the credentials using environment variables and pass the <code>endpoint</code>.</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token string">""</span><br><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token string">""</span><br>chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"amazon"</span> <span class="token punctuation">\</span><br>  --storage-amazon-bucket<span class="token operator">=</span><span class="token string">"my-s3-bucket"</span> <span class="token punctuation">\</span><br>  --storage-amazon-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-amazon-region<span class="token operator">=</span><span class="token string">"us-east-1"</span> <span class="token punctuation">\</span><br>  --storage-amazon-endpoint<span class="token operator">=</span><span class="token string">"my-s3-compatible-service-endpoint"</span></code></pre>
<p>You need at least the following permissions inside your IAM Policy</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">{</span><br>  <span class="token key atrule">"Version"</span><span class="token punctuation">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span><br>  <span class="token key atrule">"Statement"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token key atrule">"Sid"</span><span class="token punctuation">:</span> <span class="token string">"AllowListObjects"</span><span class="token punctuation">,</span><br>      <span class="token key atrule">"Effect"</span><span class="token punctuation">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span><br>      <span class="token key atrule">"Action"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token string">"s3:ListBucket"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token key atrule">"Resource"</span><span class="token punctuation">:</span> <span class="token string">"arn:aws:s3:::my-s3-bucket"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      <span class="token key atrule">"Sid"</span><span class="token punctuation">:</span> <span class="token string">"AllowObjectsCRUD"</span><span class="token punctuation">,</span><br>      <span class="token key atrule">"Effect"</span><span class="token punctuation">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span><br>      <span class="token key atrule">"Action"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><br>        <span class="token string">"s3:DeleteObject"</span><span class="token punctuation">,</span><br>        <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span><br>        <span class="token string">"s3:PutObject"</span><br>      <span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token key atrule">"Resource"</span><span class="token punctuation">:</span> <span class="token string">"arn:aws:s3:::my-s3-bucket/*"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>In order to work with AWS service accounts you may need to set <code>AWS_SDK_LOAD_CONFIG=1</code> in your environment.<br>
For more context, please see <a href="https://github.com/helm/chartmuseum/issues/280#issuecomment-592292527">here</a>.</p>
<p>For DigitalOcean, set the credentials using environment variable and pass the <code>endpoint</code>.<br>
Note below, that the region <code>us-east-1</code> needs to be set, since that is how the DigitalOcean cli implementation functions. The actual region of your spaces location is defined by the endpoint. Below we are using Frankfurt as an example.</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token string">"spaces_access_key"</span><br><span class="token builtin class-name">export</span> <span class="token assign-left variable">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token string">"spaces_secret_key"</span><br>  chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"amazon"</span> <span class="token punctuation">\</span><br>  --storage-amazon-bucket<span class="token operator">=</span><span class="token string">"my_spaces_name"</span> <span class="token punctuation">\</span><br>  --storage-amazon-prefix<span class="token operator">=</span><span class="token string">"my_spaces_name_subfolder"</span> <span class="token punctuation">\</span><br>  --storage-amazon-region<span class="token operator">=</span><span class="token string">"us-east-1"</span> <span class="token punctuation">\</span><br>  --storage-amazon-endpoint<span class="token operator">=</span><span class="token string">"https://fra1.digitaloceanspaces.com"</span></code></pre>
<p>The access_key and secret_key can be generated from the DigitalOcean console, under the section API/Spaces_access_keys.</p>
<p>Note: on certain S3-based storage backends, the <code>LastModified</code> field on objects<br>
is truncated to the nearest second. For more info, please see issue <a href="https://github.com/helm/chartmuseum/issues/152">#152</a>.</p>
<p>In order to mitigate this, you may use use the <code>--storage-timestamp-tolerance</code> option.<br>
For example, to round to the nearest second, you could use <code>--storage-timestamp-tolerance=1s</code>.<br>
For acceptable values to use for this field, please see <a href="https://golang.org/pkg/time/#ParseDuration">here</a>.</p>
<h4 id="using-with-google-cloud-storage" tabindex="-1">Using with Google Cloud Storage <a class="direct-link" href="#using-with-google-cloud-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-gcs-bucket</code>.</p>
<p>One way to do so is to set the <code>GOOGLE_APPLICATION_CREDENTIALS</code> var in your environment, pointing to the JSON file containing your service account key:</p>
<pre><code>export GOOGLE_APPLICATION_CREDENTIALS=&quot;/home/user/Downloads/[FILE_NAME].json&quot;
</code></pre>
<p>More info on Google Cloud authentication can be found <a href="https://cloud.google.com/docs/authentication/getting-started">here</a>.</p>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"google"</span> <span class="token punctuation">\</span><br>  --storage-google-bucket<span class="token operator">=</span><span class="token string">"my-gcs-bucket"</span> <span class="token punctuation">\</span><br>  --storage-google-prefix<span class="token operator">=</span><span class="token string">""</span></code></pre>
<h4 id="using-with-microsoft-azure-blob-storage" tabindex="-1">Using with Microsoft Azure Blob Storage <a class="direct-link" href="#using-with-microsoft-azure-blob-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>mycontainer</code>.</p>
<p>To do so, you must set the following env vars:</p>
<ul>
<li><code>AZURE_STORAGE_ACCOUNT</code></li>
<li><code>AZURE_STORAGE_ACCESS_KEY</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"microsoft"</span> <span class="token punctuation">\</span><br>  --storage-microsoft-container<span class="token operator">=</span><span class="token string">"mycontainer"</span> <span class="token punctuation">\</span><br>  --storage-microsoft-prefix<span class="token operator">=</span><span class="token string">""</span></code></pre>
<h4 id="using-with-alibaba-cloud-oss-storage" tabindex="-1">Using with Alibaba Cloud OSS Storage <a class="direct-link" href="#using-with-alibaba-cloud-oss-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-oss-bucket</code>.</p>
<p>To do so, you must set the following env vars:</p>
<ul>
<li><code>ALIBABA_CLOUD_ACCESS_KEY_ID</code></li>
<li><code>ALIBABA_CLOUD_ACCESS_KEY_SECRET</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"alibaba"</span> <span class="token punctuation">\</span><br>  --storage-alibaba-bucket<span class="token operator">=</span><span class="token string">"my-oss-bucket"</span> <span class="token punctuation">\</span><br>  --storage-alibaba-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-alibaba-endpoint<span class="token operator">=</span><span class="token string">"oss-cn-beijing.aliyuncs.com"</span></code></pre>
<h4 id="using-with-openstack-object-storage" tabindex="-1">Using with Openstack Object Storage <a class="direct-link" href="#using-with-openstack-object-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>mycontainer</code>.</p>
<p>To do so, you must set the following env vars (depending on your openstack version):</p>
<ul>
<li><code>OS_AUTH_URL</code></li>
<li>either <code>OS_PROJECT_NAME</code> or <code>OS_TENANT_NAME</code> or <code>OS_PROJECT_ID</code> or <code>OS_TENANT_ID</code></li>
<li>either <code>OS_DOMAIN_NAME</code> or <code>OS_DOMAIN_ID</code></li>
<li>either <code>OS_USERNAME</code> or <code>OS_USERID</code></li>
<li><code>OS_PASSWORD</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"openstack"</span> <span class="token punctuation">\</span><br>  --storage-openstack-container<span class="token operator">=</span><span class="token string">"mycontainer"</span> <span class="token punctuation">\</span><br>  --storage-openstack-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-openstack-region<span class="token operator">=</span><span class="token string">"myregion"</span></code></pre>
<p>For Swift V1 Auth you must set the following env vars:</p>
<ul>
<li><code>ST_AUTH</code></li>
<li><code>ST_USER</code></li>
<li><code>ST_KEY</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"openstack"</span> <span class="token punctuation">\</span><br>  --storage-openstack-auth<span class="token operator">=</span><span class="token string">"v1"</span> <span class="token punctuation">\</span><br>  --storage-openstack-container<span class="token operator">=</span><span class="token string">"mycontainer"</span> <span class="token punctuation">\</span><br>  --storage-openstack-prefix<span class="token operator">=</span><span class="token string">""</span></code></pre>
<h4 id="using-with-oracle-cloud-infrastructure-object-storage" tabindex="-1">Using with Oracle Cloud Infrastructure Object Storage <a class="direct-link" href="#using-with-oracle-cloud-infrastructure-object-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-ocs-bucket</code>.</p>
<p>More info on Oracle Cloud Infrastructure authentication can be found <a href="https://docs.cloud.oracle.com/iaas/Content/API/Concepts/apisigningkey.htm">here</a>.</p>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"oracle"</span> <span class="token punctuation">\</span><br>  --storage-oracle-bucket<span class="token operator">=</span><span class="token string">"my-ocs-bucket"</span> <span class="token punctuation">\</span><br>  --storage-oracle-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-oracle-compartmentid<span class="token operator">=</span><span class="token string">"ocid1.compartment.oc1..1234"</span></code></pre>
<h4 id="using-with-baidu-cloud-bos-storage" tabindex="-1">Using with Baidu Cloud BOS Storage <a class="direct-link" href="#using-with-baidu-cloud-bos-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-bos-bucket</code>.</p>
<p>To do so, you must set the following env vars:</p>
<ul>
<li><code>BAIDU_CLOUD_ACCESS_KEY_ID</code></li>
<li><code>BAIDU_CLOUD_ACCESS_KEY_SECRET</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"baidu"</span> <span class="token punctuation">\</span><br>  --storage-baidu-bucket<span class="token operator">=</span><span class="token string">"my-bos-bucket"</span> <span class="token punctuation">\</span><br>  --storage-baidu-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-baidu-endpoint<span class="token operator">=</span><span class="token string">"bj.bcebos.com"</span></code></pre>
<h4 id="using-with-tencent-cloud-cos-storage" tabindex="-1">Using with Tencent Cloud COS Storage <a class="direct-link" href="#using-with-tencent-cloud-cos-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-cos-bucket</code>.</p>
<p>To do so, you must set the following env vars:</p>
<ul>
<li><code>TENCENT_CLOUD_COS_SECRET_ID</code></li>
<li><code>TENCENT_CLOUD_COS_SECRET_KEY</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"tencent"</span> <span class="token punctuation">\</span><br>  --storage-tencent-bucket<span class="token operator">=</span><span class="token string">"my-cos-bucket"</span> <span class="token punctuation">\</span><br>  --storage-tencent-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-tencent-endpoint<span class="token operator">=</span><span class="token string">"cos.ap-beijing.myqcloud.com"</span></code></pre>
<h4 id="using-with-netease-cloud-nos-storage" tabindex="-1">Using with Netease Cloud NOS Storage <a class="direct-link" href="#using-with-netease-cloud-nos-storage" aria-hidden="true">#</a></h4>
<p>Make sure your environment is properly setup to access <code>my-nos-bucket</code>.</p>
<p>To do so, you must set the following env vars:</p>
<ul>
<li><code>NETEASE_CLOUD_ACCESS_KEY_ID</code></li>
<li><code>NETEASE_CLOUD_ACCESS_KEY_SECRET</code></li>
</ul>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"netease"</span> <span class="token punctuation">\</span><br>  --storage-netease-bucket<span class="token operator">=</span><span class="token string">"my-nos-bucket"</span> <span class="token punctuation">\</span><br>  --storage-netease-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-netease-endpoint<span class="token operator">=</span><span class="token string">"nos-eastchina1.126.net"</span></code></pre>
<h4 id="using-with-etcd" tabindex="-1">Using with etcd <a class="direct-link" href="#using-with-etcd" aria-hidden="true">#</a></h4>
<p>To use etcd as backend you need the CA certificate and the signed key pair.<br>
See <a href="https://coreos.com/etcd/docs/latest/op-guide/security.html">here</a></p>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"etcd"</span> <span class="token punctuation">\</span><br>  --storage-etcd-cafile<span class="token operator">=</span><span class="token string">"/path/to/ca.crt"</span> <span class="token punctuation">\</span><br>  --storage-etcd-certfile<span class="token operator">=</span><span class="token string">"/path/to/server.crt"</span> <span class="token punctuation">\</span><br>  --storage-etcd-keyfile<span class="token operator">=</span><span class="token string">"/path/to/server.key"</span> <span class="token punctuation">\</span><br>  --storage-etcd-prefix<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --storage-etcd-endpoint<span class="token operator">=</span><span class="token string">"http://localhost:2379"</span></code></pre>
<h4 id="using-with-local-filesystem-storage" tabindex="-1">Using with local filesystem storage <a class="direct-link" href="#using-with-local-filesystem-storage" aria-hidden="true">#</a></h4>
<p>Make sure you have read-write access to <code>./chartstorage</code> (will create if doesn't exist on first upload)</p>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"local"</span> <span class="token punctuation">\</span><br>  --storage-local-rootdir<span class="token operator">=</span><span class="token string">"./chartstorage"</span></code></pre>
<h4 id="basic-auth" tabindex="-1">Basic Auth <a class="direct-link" href="#basic-auth" aria-hidden="true">#</a></h4>
<p>If both of the following options are provided, basic http authentication will protect all routes:</p>
<ul>
<li><code>--basic-auth-user=&lt;user&gt;</code> - username for basic http authentication</li>
<li><code>--basic-auth-pass=&lt;pass&gt;</code> - password for basic http authentication</li>
</ul>
<p>You may want basic auth to only be applied to operations that can change Charts, i.e. PUT, POST and DELETE.  So to avoid basic auth on GET operations use</p>
<ul>
<li><code>--auth-anonymous-get</code> - allow anonymous GET operations</li>
</ul>
<h4 id="bearertoken-auth" tabindex="-1">Bearer/Token Auth <a class="direct-link" href="#bearertoken-auth" aria-hidden="true">#</a></h4>
<p>If all of the following options are provided, bearer auth will protect all routes:</p>
<ul>
<li><code>--bearer-auth</code> - enables bearer auth</li>
<li><code>--auth-realm=&lt;realm&gt;</code> - authorization server url</li>
<li><code>--auth-service=&lt;service&gt;</code> - authorization server service name</li>
<li><code>--auth-cert-path=&lt;path&gt;</code> - path to authorization server public pem file</li>
</ul>
<p>Using options above, <em>ChartMuseum</em> is configured with a public key, and will accept RS256 JWT tokens signed by the associated private key, passed in the <code>Authorization</code> header. You can use the <a href="https://github.com/chartmuseum/auth">chartmuseum/auth</a> Go library to generate valid JWT tokens.</p>
<p>In order to gain access to a specific resource, the JWT token must contain an <code>access</code> section in the claims. This section indicates which resources the user is able to access. Here is an example token payload:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"exp"</span><span class="token operator">:</span> <span class="token number">1543995770</span><span class="token punctuation">,</span><br>  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1543995470</span><span class="token punctuation">,</span><br>  <span class="token property">"access"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"artifact-repository"</span><span class="token punctuation">,</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"org1/repo1"</span><span class="token punctuation">,</span><br>      <span class="token property">"actions"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>        <span class="token string">"pull"</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>The <code>type</code> is always &quot;artifact-repository&quot;, the <code>name</code> is the namespace/tenant (just use the string &quot;repo&quot; if using single-tenant server), and <code>actions</code> is an array of actions the user can perform (&quot;pull&quot; and/or &quot;push).</p>
<p>For more information about how this works, please see <a href="https://github.com/chartmuseum/auth-server-example">chartmuseum/auth-server-example</a>.</p>
<h4 id="https" tabindex="-1">HTTPS <a class="direct-link" href="#https" aria-hidden="true">#</a></h4>
<p>If both of the following options are provided, the server will listen and serve HTTPS:</p>
<ul>
<li><code>--tls-cert=&lt;crt&gt;</code> - path to tls certificate chain file</li>
<li><code>--tls-key=&lt;key&gt;</code> - path to tls key file</li>
</ul>
<h5 id="https-with-client-certificate-authentication" tabindex="-1">HTTPS with Client Certificate Authentication <a class="direct-link" href="#https-with-client-certificate-authentication" aria-hidden="true">#</a></h5>
<p>If the above HTTPS values are provided in addition to below, the server will listen and serve HTTPS and authenticate client requests against the CA certificate:</p>
<ul>
<li><code>--tls-ca-cert=&lt;cacert&gt;</code> - path to tls certificate file</li>
</ul>
<h4 id="just-generating-index.yaml" tabindex="-1">Just generating index.yaml <a class="direct-link" href="#just-generating-index.yaml" aria-hidden="true">#</a></h4>
<p>You can specify the <code>--gen-index</code> option if you only wish to use <em>ChartMuseum</em> to generate your index.yaml file. Note that this will only work with <code>--depth=0</code>.</p>
<p>The contents of index.yaml will be printed to stdout and the program will exit. This is useful if you are satisfied with your current Helm CI/CD process and/or don't want to monitor another webservice.</p>
<h4 id="other-cli-options" tabindex="-1">Other CLI options <a class="direct-link" href="#other-cli-options" aria-hidden="true">#</a></h4>
<ul>
<li><code>--log-json</code> - output structured logs as json</li>
<li><code>--log-health</code> - log incoming /health requests</li>
<li><code>--log-latency-integer</code> - log latency as an integer (nanoseconds) instead of a string</li>
<li><code>--disable-api</code> - disable all routes prefixed with /api</li>
<li><code>--disable-delete</code> - explicitly disable the delete chart route</li>
<li><code>--disable-statefiles</code> - disable use of index-cache.yaml</li>
<li><code>--allow-overwrite</code> - allow chart versions to be re-uploaded without ?force querystring</li>
<li><code>--disable-force-overwrite</code> - do not allow chart versions to be re-uploaded, even with ?force querystring</li>
<li><code>--chart-url=&lt;url&gt;</code> - absolute url for .tgzs in index.yaml</li>
<li><code>--storage-amazon-endpoint=&lt;endpoint&gt;</code> - alternative s3 endpoint</li>
<li><code>--storage-amazon-sse=&lt;algorithm&gt;</code> - s3 server side encryption algorithm</li>
<li><code>--storage-openstack-cacert=&lt;path&gt;</code> - path to a custom ca certificates bundle for openstack</li>
<li><code>--chart-post-form-field-name=&lt;field&gt;</code> - form field which will be queried for the chart file content</li>
<li><code>--prov-post-form-field-name=&lt;field&gt;</code> - form field which will be queried for the provenance file content</li>
<li><code>--index-limit=&lt;number&gt;</code> - limit the number of parallel indexers</li>
<li><code>--context-path=&lt;path&gt;</code> - base context path (new root for application routes)</li>
<li><code>--depth=&lt;number&gt;</code> - levels of nested repos for multitenancy</li>
<li><code>--cors-alloworigin=&lt;value&gt;</code> - value to set in the Access-Control-Allow-Origin HTTP header</li>
<li><code>--read-timeout=&lt;number&gt;</code> - socket read timeout for http server</li>
<li><code>--write-timeout=&lt;number&gt;</code> - socker write timeout for http server</li>
</ul>
<h3 id="docker-image" tabindex="-1">Docker Image <a class="direct-link" href="#docker-image" aria-hidden="true">#</a></h3>
<p>Available via <a href="https://github.com/orgs/helm/packages/container/package/chartmuseum">GitHub Container Registry (GHCR)</a>.</p>
<p>Example usage (local storage):</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run --rm -it <span class="token punctuation">\</span><br>  -p <span class="token number">8080</span>:8080 <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">STORAGE</span><span class="token operator">=</span>local <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">STORAGE_LOCAL_ROOTDIR</span><span class="token operator">=</span>/charts <span class="token punctuation">\</span><br>  -v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/charts:/charts <span class="token punctuation">\</span><br>  ghcr.io/helm/chartmuseum:v0.13.1</code></pre>
<p>Example usage (S3):</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">docker</span> run --rm -it <span class="token punctuation">\</span><br>  -p <span class="token number">8080</span>:8080 <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">DEBUG</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">STORAGE</span><span class="token operator">=</span><span class="token string">"amazon"</span> <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">STORAGE_AMAZON_BUCKET</span><span class="token operator">=</span><span class="token string">"my-s3-bucket"</span> <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">STORAGE_AMAZON_PREFIX</span><span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  -e <span class="token assign-left variable">STORAGE_AMAZON_REGION</span><span class="token operator">=</span><span class="token string">"us-east-1"</span> <span class="token punctuation">\</span><br>  -v ~/.aws:/home/chartmuseum/.aws:ro <span class="token punctuation">\</span><br>  ghcr.io/helm/chartmuseum:v0.13.1</code></pre>
<h3 id="helm-chart" tabindex="-1">Helm Chart <a class="direct-link" href="#helm-chart" aria-hidden="true">#</a></h3>
<p>There is a <a href="https://github.com/chartmuseum/charts/tree/main/src/chartmuseum">Helm chart for <em>ChartMuseum</em></a> itself.</p>
<p>You can also view it on <a href="https://artifacthub.io/packages/helm/chartmuseum/chartmuseum">Artifact Hub</a>.</p>
<p>To install:</p>
<pre class="language-bash"><code class="language-bash">helm repo <span class="token function">add</span> chartmuseum https://chartmuseum.github.io/charts<br>helm <span class="token function">install</span> chartmuseum/chartmuseum</code></pre>
<p>If interested in making changes, please submit a PR to <a href="https://github.com/chartmuseum/charts">chartmuseum/charts</a>. Before doing any work, please check for any <a href="https://github.com/chartmuseum/charts/pulls?q=is%3Apr+is%3Aopen">currently open pull requests</a>. Thanks!</p>
<h2 id="multitenancy" tabindex="-1">Multitenancy <a class="direct-link" href="#multitenancy" aria-hidden="true">#</a></h2>
<p>Multitenancy is supported with the <code>--depth</code> flag.</p>
<p>To begin, start with a directory structure such as</p>
<pre><code>charts
‚îú‚îÄ‚îÄ org1
‚îÇ   ‚îú‚îÄ‚îÄ repoa
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nginx-ingress-0.9.3.tgz
‚îú‚îÄ‚îÄ org2
‚îÇ   ‚îú‚îÄ‚îÄ repob
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ chartmuseum-0.4.0.tgz
</code></pre>
<p>This represents a storage layout appropriate for <code>--depth=2</code>. The organization level can be eliminated by using <code>--depth=1</code>. The default depth is 0 (singletenant server).</p>
<p>Start the server with <code>--depth=2</code>, pointing to the <code>charts/</code> directory:</p>
<pre><code>chartmuseum --debug --depth=2 --storage=&quot;local&quot; --storage-local-rootdir=./charts
</code></pre>
<p>This example will provide two separate Helm Chart Repositories at the following locations:</p>
<ul>
<li><code>http://localhost:8080/org1/repoa</code></li>
<li><code>http://localhost:8080/org2/repob</code></li>
</ul>
<p>This should work with all supported storage backends.</p>
<p>To use the chart manipulation routes, simply place the name of the repo directly after &quot;/api&quot; in the route:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> -F <span class="token string">"chart=@mychart-0.1.0.tgz"</span> http://localhost:8080/api/org1/repoa/charts</code></pre>
<p>You may also experiment with the <code>--depth-dynamic</code> flag, which should allow for dynamic depth levels (i.e. all of <code>/api/charts</code>, <code>/api/myrepo/charts</code>, <code>/api/org1/repoa/charts</code>).</p>
<h2 id="pagination" tabindex="-1">Pagination <a class="direct-link" href="#pagination" aria-hidden="true">#</a></h2>
<p>For large chart repositories, you may wish to paginate the results from the <code>GET /api/charts</code> route.</p>
<p>To do so, add the <code>offset</code> and <code>limit</code> query params to the request. For example, to retrieve a list of 5 charts total, skipping the first 5 charts, you could use the following:</p>
<pre><code>GET /api/charts?offset=5&amp;limit=5
</code></pre>
<h2 id="cache" tabindex="-1">Cache <a class="direct-link" href="#cache" aria-hidden="true">#</a></h2>
<p>By default, the contents of <code>index.yaml</code> (per-tenant) will be stored in memory. This means that memory usage will continue to grow indefinitely as more charts are added to storage.</p>
<p>You may wish to offload this to an external cache store, especially for large, multitenant installations.</p>
<h3 id="cache-interval" tabindex="-1">Cache Interval <a class="direct-link" href="#cache-interval" aria-hidden="true">#</a></h3>
<p>When dealing with thousands of charts, you may experience latency with the default settings. This is because upon each request, the storage backend is scanned for changes compared to the cache.</p>
<p>If you are ok with <code>index.yaml</code> being out-of-date for a fixed period of time, you can improve performance by using the <code>--cache-interval=&lt;interval&gt;</code> option.<br>
When this setting is enabled, the charts available for each tenant are refreshed on a timer.</p>
<p>For example, to only check storage every 5 minutes, you can use <code>--cache-interval=5m</code>.</p>
<p>For valid values to use for this setting, please see <a href="https://godoc.org/time#ParseDuration">here</a>.</p>
<h3 id="using-redis" tabindex="-1">Using Redis <a class="direct-link" href="#using-redis" aria-hidden="true">#</a></h3>
<p>Example of using Redis as an external cache store:</p>
<pre class="language-bash"><code class="language-bash">chartmuseum --debug --port<span class="token operator">=</span><span class="token number">8080</span> <span class="token punctuation">\</span><br>  --storage<span class="token operator">=</span><span class="token string">"local"</span> <span class="token punctuation">\</span><br>  --storage-local-rootdir<span class="token operator">=</span><span class="token string">"./chartstorage"</span> <span class="token punctuation">\</span><br>  --cache<span class="token operator">=</span><span class="token string">"redis"</span> <span class="token punctuation">\</span><br>  --cache-redis-addr<span class="token operator">=</span><span class="token string">"localhost:6379"</span> <span class="token punctuation">\</span><br>  --cache-redis-password<span class="token operator">=</span><span class="token string">""</span> <span class="token punctuation">\</span><br>  --cache-redis-db<span class="token operator">=</span><span class="token number">0</span></code></pre>
<h2 id="prometheus-metrics" tabindex="-1">Prometheus Metrics <a class="direct-link" href="#prometheus-metrics" aria-hidden="true">#</a></h2>
<p>ChartMuseum exposes its <a href="https://prometheus.io/docs/concepts/metric_types/">Prometheus metrics</a> at the <code>/metrics</code> route on the main port. This can be disabled with the <code>--disable-metrics</code> command-line flag or the <code>DISABLE_METRICS</code> environment variable.</p>
<blockquote>
<p>Note that the Kubernetes chart currently disables metrics by default (<code>DISABLE_METRICS=true</code> is set in the chart).</p>
</blockquote>
<p>Below are the current application metrics exposed. Note that there is a per tenant (repo) label. The repo label corresponds to the depth parameter, so a depth=2 as the example above would<br>
have repo labels named <code>org1/repoa</code> and <code>org2/repob</code>.</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Type</th>
<th>Labels</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>chartmuseum_charts_served_total</td>
<td>Gauge</td>
<td>{repo=&quot;*&quot;}</td>
<td>Total number of charts</td>
</tr>
<tr>
<td>chartmuseum_charts_versions_served_total</td>
<td>Gauge</td>
<td>{repo=&quot;*&quot;}</td>
<td>Total number of chart versions available</td>
</tr>
</tbody>
</table>
<p>*: see above for repo label</p>
<p>There are other general global metrics harvested (per process, hence for all tenants). You can get the complete list by using the <code>/metrics</code> route.</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Type</th>
<th>Labels</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>chartmuseum_request_duration_seconds</td>
<td>Summary</td>
<td>{quantile=&quot;0.5&quot;}, {quantile=&quot;0.9&quot;}, {quantile=&quot;0.99&quot;}</td>
<td>The HTTP request latencies in seconds</td>
</tr>
<tr>
<td>chartmuseum_request_duration_seconds_sum</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>chartmuseum_request_duration_seconds_count</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>chartmuseum_request_size_bytes</td>
<td>Summary</td>
<td>{quantile=&quot;0.5&quot;}, {quantile=&quot;0.9&quot;}, {quantile=&quot;0.99&quot;}</td>
<td>The HTTP request sizes in bytes</td>
</tr>
<tr>
<td>chartmuseum_request_size_bytes_sum</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>chartmuseum_request_size_bytes_count</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>chartmuseum_response_size_bytes</td>
<td>Summary</td>
<td>{quantile=&quot;0.5&quot;}, {quantile=&quot;0.9&quot;}, {quantile=&quot;0.99&quot;}</td>
<td>The HTTP response sizes in bytes</td>
</tr>
<tr>
<td>chartmuseum_response_size_bytes_sum</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>chartmuseum_response_size_bytes_count</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>go_goroutines</td>
<td>Gauge</td>
<td></td>
<td>Number of goroutines that currently exist</td>
</tr>
</tbody>
</table>
<h2 id="notes-on-index.yaml" tabindex="-1">Notes on index.yaml <a class="direct-link" href="#notes-on-index.yaml" aria-hidden="true">#</a></h2>
<p>The repository index (index.yaml) is dynamically generated based on packages found in storage. If you store your own version of index.yaml, it will be completely ignored.</p>
<p><code>GET /index.yaml</code> occurs when you run <code>helm repo add chartmuseum http://localhost:8080</code> or <code>helm repo update</code>.</p>
<p>If you manually add/remove a .tgz package from storage, it will be immediately reflected in <code>GET /index.yaml</code>.</p>
<p>You are no longer required to maintain your own version of index.yaml using <code>helm repo index --merge</code>.</p>
<p>The <code>--gen-index</code> CLI option (described above) can be used to generate and print index.yaml to stdout.</p>
<p>Upon index regeneration, <em>ChartMuseum</em> will, however, save a statefile in storage called <code>index-cache.yaml</code> used for cache optimization. This file is only meant for internal use, but may be able to be used for migration to simple storage.</p>
<h2 id="mirroring-the-official-kubernetes-repositories" tabindex="-1">Mirroring the official Kubernetes repositories <a class="direct-link" href="#mirroring-the-official-kubernetes-repositories" aria-hidden="true">#</a></h2>
<p>Please see <code>scripts/mirror-k8s-repos.sh</code> for an example of how to download all .tgz packages from the official Kubernetes repositories (both stable and incubator).</p>
<p>You can then use <em>ChartMuseum</em> to serve up an internal mirror:</p>
<pre><code>scripts/mirror-k8s-repos.sh
chartmuseum --debug --port=8080 --storage=&quot;local&quot; --storage-local-rootdir=&quot;./mirror&quot;
</code></pre>
<h2 id="original-logo" tabindex="-1">Original Logo <a class="direct-link" href="#original-logo" aria-hidden="true">#</a></h2>
<p><sub><strong><em>&quot;Preserve your precious artifacts... in the cloud!&quot;</em></strong><sub></p>
<p><img src="./logo.png" alt=""></p>
<h2 id="subprojects" tabindex="-1">Subprojects <a class="direct-link" href="#subprojects" aria-hidden="true">#</a></h2>
<p>The following subprojects are maintained by <em>ChartMuseum</em>:</p>
<ul>
<li><a href="https://github.com/chartmuseum/helm-push">chartmuseum/helm-push</a> - Helm plugin to push chart package to ChartMuseum</li>
<li><a href="https://github.com/chartmuseum/storage">chartmuseum/storage</a> - Go library providing common interface for working across multiple cloud storage backends</li>
<li><a href="https://github.com/chartmuseum/auth">chartmuseum/auth</a> - Go library for generating ChartMuseum JWT Tokens, authorizing HTTP requests, etc.</li>
<li><a href="https://github.com/chartmuseum/auth-server-example">chartmuseum/auth-server-example</a> - Example server providing JWT tokens for ChartMuseum auth</li>
<li><a href="https://github.com/chartmuseum/testbed">chartmuseum/testbed</a> - Docker testbed for continuous integration</li>
<li><a href="https://github.com/chartmuseum/www">chartmuseum/www</a> - <a href="http://chartmuseum.com">chartmuseum.com</a> static site source code</li>
<li><a href="https://github.com/chartmuseum/ui">chartmuseum/ui</a> - ChartMuseum frontend UI</li>
</ul>
<h2 id="community" tabindex="-1">Community <a class="direct-link" href="#community" aria-hidden="true">#</a></h2>
<p>You can reach the <em>ChartMuseum</em> community and developers in the <a href="https://slack.k8s.io">Kubernetes Slack</a> <strong>#chartmuseum</strong> channel.</p>

<hr>
<ul><li>Next: <a href="/posts/Helm quick commands/">Helm Quick Commands</a></li><li>Previous: <a href="/posts/dafyomi/2022-02-09DY - Moed Katan 28/">Moed Katan 28</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/ChertMuseum/ -->

  </body>
</html>
