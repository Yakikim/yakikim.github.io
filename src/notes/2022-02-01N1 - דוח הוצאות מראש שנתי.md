---
layout: mynote
cssclasses: rtl
tags: [notes ,17303,spec, purchassing, erp, op] 
created: 2022-02-01 11:04
modified: 2022-02-01 11:04
type: Document
title:  דוח הוצאות מראש שנתי 
---
Week Of: [[2022-01-30]]
[[2022-02-01]]


#  איפיון דוח הוצאות מראש שנתי


[[home]]/[[Open University]]/[[Memos]]

## רקע\תיאור
יש תוכנית Concurrent שהקוד שלה במערכת הוא `OP_EXPENSE_17303` והיא מחוללת טופס XML-Publisher עם פלט PDF.
![[Pasted image 20220201110709.png]]
התוכנית הזו מתוזמנת ושולחת מיילים עם צרופת PDF של הדוח מדי חודש בחודשו לרשימת נמענים.
התוכנית מתוזמנת כך שהפרמטרים שמגיעים לתוכנית לא מלאים ובשלב הרצת השליפה, התוכנית מאכלסת את הפרמטרים, כברירת מחדל, את הראשון לחודש הקודם(P_FROM_DATE) עד הראשון לחודש הנוכחי(P_TO_DATE).

## דרישה לביצוע
חלק מהמשתמשים מעוניינים לקבל:
- בנוסף למייל הנוכחי
- במייל נפרד
- מדי חודש

את אותו הפלט של הדוח רק שהתאריכים שהדוח מתייחס אליהם יהיו ***שנתיים*** ולא ***חודשיים***.
> חשוב: השנה המדוברת הינה שנה **תקציבית** ולא שנה **קלנדרית**

כך לדוגמא המצב הרצוי לאחר השינוי בדוח של 02/03/2022:
מייל 1 - מתקבל עם פלט PDF ובו נתוני ההוצאות מראש שבין 01/02/2022 לבין 01/03/2022.
מייל 2 - מתקבל עם פלט PDF ובו נתוני ההוצאות מראש שבין 01/10/2021 לבין 30/09/2022

## פתרון
כל פתרון מתקבל בברכה, רק שיאפשר  
1. להמשיך ולאפשר הרצה ידנית של הדוח וללא קשר לתזמון שליחת המיילים.
2. תזמון חודשי בנפרד ותזמון שנתי בנפרד.
3. לא להצריך הרצה חדשה מדי שנה (כלומר בחירת השנה התקציבית תהיה בזמן הריצה. מצו"ב שליפות שאני מכיר לשנה התקציבית)

### שליפות שנה תקציבית

````ad-code
title: תחילת שנה תקציבית
```plsql
SELECT START_DATE
  FROM GL_PERIODS A
 WHERE A.PERIOD_SET_NAME = 'MLM_OU_Phiscal'
   AND PERIOD_YEAR =
       (SELECT PERIOD_YEAR
          FROM GL_PERIODS B
         WHERE B.PERIOD_SET_NAME = 'MLM_OU_Phiscal'
           AND TRUNC(SYSDATE) BETWEEN START_DATE AND END_DATE)
   AND A.PERIOD_NUM = 1;
```
````

````ad-code
title: סוף שנה תקציבית
```plsql

SELECT END_DATE
  FROM GL_PERIODS A
 WHERE A.PERIOD_SET_NAME = 'MLM_OU_Phiscal'
   AND PERIOD_YEAR =
       (SELECT PERIOD_YEAR
          FROM GL_PERIODS B
         WHERE B.PERIOD_SET_NAME = 'MLM_OU_Phiscal'
           AND TRUNC(SYSDATE) BETWEEN START_DATE AND END_DATE)
   AND A.PERIOD_NUM = 12;
```
````



- [ ] #task מה סטטוס הביצוע 📅 2022-03-01