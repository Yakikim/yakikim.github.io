---
layout: mynote
tags: [notes, memo, op, apex, management, infrastructures] 
created: 2021-08-16 09:42
modified: 2021-08-16 09:42
type: Document
---
Week Of: [[2021-08-15]]
[[2021-08-09]]


# סיכום ישיבה עם נחשון בנושא API למערכת הTFS

[[home]]/[[Open University]]/[[Memos]]

## רקע\תיאור
### גישה ל-RESTful API של ה-TFS
ביקשתי משגיב ברהום שיפתח לי ב-[[ACL]] של סביבות ה-Sandbox וה-DevTest שבהקמה את השרת של ה-TFS
`http://tfs1:8080/tfs/Codesafe/`.
 שגיב אמר לי, בצדק, שיש לקבל את אישורו של נחשון. הצרכים הינם לאור התכנון שבמסגרתו:
1. בשלב ראשון, ובהנחה שהפיתוח ב-APEX לא יהיה מרוכז בידי צוות פיתוח ייעודי, (כי אם כן, ההבנה של שנינו הינה שאין צורך בפיתוח הזה אלא יש לבצע Commits ושמירת גרסאות באופן העבודה הנכון) יש לבצע גיבוי קוד אוטומטי לילי של האפליקציות ומרחבי העבודה (Workspaces) בסביבות הפיתוח וה-PROD. הגיבוי ייעשה ל-GIT-Repository ייעודי עם גישת קריאה בלבד למפתחים וממנו יוכלו לשחזר אפליקציות בגרסה הרצויה ולנקודת הזמן הרצויה. 
```ad-info
title: תוספת בעקבות שיחה עם שגיב
collapse: open
הרחבה לגבי הצורך בזה: מקרה שקרה ובסביבת ה-PROD קיימת גרסת אפליקציה שכוללת תיקון באג במסך 1. בסביבת הפיתוח קיימת גרסה שהבאג במסך 1 לא תוקן אך פותח לה מסך נוסף - מסך 2. הגרסה של סביבת הפיתוח הועברה לסביבת PROD והבאג שב והופיע במסך 1 מאחר והמסך שב לגרסה שלפני התיקון. במצב שבו יש עדכון יומי ל-GIT, ניתן לבצע בקרת שינויים בין הגרסאות ולחזור ליום שבו היה התיקון, להעביר את הגרסא לסביבת הפיתוח ולבצע Merge בין הגרסאות - זו שכוללת את התיקון וזו שכוללת את הפיתוח. כמובן שרצוי היה שהגיבוי היה נעשה ע"י המפתח באמצעות Commits שמבוצעים לאחר כל שינוי ויש לגביהם מידע איכותי יותר, אך במדה ואין ריכוז צוות פיתוח ע"י נהלים והרגלים מוסכמים, זהו פתרון טוב שיכול לתת מענה למקרים כגון אלו שבהם אין שגיאת מערכת אבל כן יש שגיאת עבודה)
```
2. בשלב שני, מתוכנן לבצע (כתלות במבנה הארגוני של ניהול התמיכה בפלטפורמה) אינטגרציה  בין באגים שמדווחים ע"י המשתמשים במערכת דיווחי הבאגים של הפלטפורמה, לבין מערכת ה-WorkItems של ה-TFS.(אינטגרציה חלקית, במדה ודיווח תלונה של משתמשים במערכת דיוחי הבעיות ב-APEX עברה לטיפול צוות הפיתוח ונדרשת יצירת\שינוי קוד אפליקטיבי) 
1. שלבים אפשריים בהמשך: (כנ"ל, כתלות במבנה הארגוני) ביצוע Deploy+Tests+Release באמצעות מערכת הTFS וניהול הקוד. כך שבאמצעות Merge של ענף כלשהו אל תוך ה-Master או באמצעות PullRequest לענף ה-Master יונע התהליך שחלקו יבוצע מתוך ה-APEX. 
### תכנון אופן הגישה לשירות CheckAccess של ה-RBAC 
לאור זה שנכחנו בפגישת הזום רק שנינו (אני ונחשון), ניצלתי את ההזדמנות ע"מ לדון בנושא נוסף של גישה לשירות בדיקת הרשאות ה-RBAC מהסביבות המוקמות. אני אמרתי כי ניתן לבצע את הפרוצדורה של ה-Check Access באמצעות גישה ל-DB הארגוני המתאים, אך מוטב היה לו היה ניתן לחסוך במשאבי רשת ובתחזוקת קוד באם במקום לגשת בשירות ORDS ל-DB הארגוניים, תינתן הגישה ל-WebService ייעודי, שיכתוב נחשון, ואליו נפנה בשביל השירות של CheckAccess. 
## משתתפים
יקי קמחי
נחשון גבעוני 
## מסקנות ופעולות
סוכם כדלהלן:
1. הסכמנו כי טוב ששוחחנו בעניינים הללו, ישנה חשיבות רבה בדיון זה בארכיטקטורה המתהווה ומוטב אילו היינו מבצעים זאת על בסיס קבוע.
2. סיכמנו שבאופן עקרוני, יותר השימוש ב-RESTful-API ממערכת ה-TFS, אך לשם הסדר הטוב, בכל פניה חדשה לשירות חדש במערכת, יישלח ה-API לידיעתו ובחינתו של נחשון. 
3. נחשון יבצע חשיבה בנושא אופן הקריאה לפרוצדורת ה-CheckAccess של מערכת ההרשאות RBAC, החשיבה הינה לגבי יעילות ותחזוקת הקוד שירצה לבצע ולפי זה תתבצע הגישה לפרוצדורה. 
4. מה שלא יוחלט לגבי הכתובת לקבלת השירות, הפניה ל-CheckAccess תתבצע באמצעות פרוצדורה פנימית (ב-DB של סביבת ה-APEX) שתעטוף את הקריאה ל-WebService, כך שבמדה ונשנה את הכתובת לפניה או את גרסת השירות, יהיה ניתן לעדכן במקום אחד ומרכזי.

## מעקב והמשך טיפול
### RESTful API עיקריים שמתוכננים להיות בשימוש 

| מטרה                         | תיאור והדרכה                                                                                                                                                                                  |
| ---------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| יצירת באג\משימה\בדיקה לטיפול | [Work Items - Create - REST API (Azure DevOps Work Item Tracking) \| Microsoft Docs](https://docs.microsoft.com/en-us/rest/api/azure/devops/wit/work-items/create?view=azure-devops-rest-4.1) |
| גיבוי קוד לילי               | [Pushes - Create - REST API (Azure DevOps Git) \| Microsoft Docs](https://docs.microsoft.com/en-us/rest/api/azure/devops/git/pushes/create?view=azure-devops-rest-4.1#update-a-file)          |



````ad-code
title: Example for using RESTful API to push .md file to OP's GIT

[[TFS Basic Auth]]
Before any push, the oldObjectId should be taken:
```bash
curl -D- \
-u yakiki@openu.ac.il:<MY TOKEN> \
-X GET \
-H "Content-Type: application/json" \
"http://tfs1:8080/tfs/Codesafe/Oracle%20APEX/_apis/git/repositories/PBackup/refs?api-version=4.1" 

```






Then, Create new text file:
```bash
curl -D- \
-u yakiki@openu.ac.il:<MY TOKEN> \
-X POST \
--data '{
  "refUpdates": [
    {
      "name": "refs/heads/master",
      "oldObjectId": "28ac7954dd51ce4bac8f122c3d6d9392c9d1844b"
    }
  ],
  "commits": [
    {
      "comment": "Added task markdown file.",
      "changes": [
        {
          "changeType": "add",
          "item": {
            "path": "/tasks.md"
          },
          "newContent": {
            "content": "# Tasks\n\n* Item 1\n* Item 2",
            "contentType": "rawtext"
          }
        }
      ]
    }
  ]
}' \
-H "Content-Type: application/json" \
"http://tfs1:8080/tfs/Codesafe/Oracle%20APEX/_apis/git/repositories/PBackup/pushes?api-version=4.1" 
```
Or Update the text file(the oldObjectId has been updated since the last run): 
```bash
curl -D- \
-u yakiki@openu.ac.il:<MY TOKEN> \
-X POST \
--data '{
  "refUpdates": [
    {
      "name": "refs/heads/master",
      "oldObjectId": "d2de24cb0b5a36643ba308398a29b0d10ac0270d"
    }
  ],
  "commits": [
    {
      "comment": "Added a few more items to the task list.",
      "changes": [
        {
          "changeType": "edit",
          "item": {
            "path": "tasks.md"
          },
          "newContent": {
            "content": "#yaki # Tasks\n\n* Item 1\n* Item 2\n* Item 3\n* Item 4\n\nIf you need to add more, update this file and add them!",
            "contentType": "rawtext"
          }
        }
      ]
    }
  ]
}' \
-H "Content-Type: application/json" \
"http://tfs1:8080/tfs/Codesafe/Oracle%20APEX/_apis/git/repositories/PBackup/pushes?api-version=4.1" 
```

````

	
- [x] #task לסיים את המסמך 📅 2021-08-17 ✅ 2021-08-16
 - [ ] #task לשבת עם שגיב על מדיניות גיבויים בהקשר הכולל 📅 2021-11-21
#memo #op/memo
